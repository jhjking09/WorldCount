<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WorldCount — Countdown Card</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  .card-shadow { box-shadow: 0 20px 60px rgba(0,0,0,.35); }
  .tick { letter-spacing: .02em }
</style>
</head>
<body class="bg-zinc-950 text-zinc-50 min-h-screen">
<header class="max-w-6xl mx-auto p-4 flex items-center justify-between">
  <h1 class="text-xl font-extrabold">WorldCount</h1>
  <a class="text-xs opacity-70" href="#how">How it works</a>
</header>

<main class="max-w-6xl mx-auto px-4 pb-24 grid lg:grid-cols-2 gap-8">
  <!-- Controls -->
  <section class="space-y-4">
    <div class="p-4 rounded-2xl bg-zinc-900/60 border border-zinc-800">
      <label class="block text-sm mb-1">Title</label>
      <input id="title" class="w-full p-2 rounded-lg bg-zinc-800" placeholder="Launch Day" value="Launch Day">
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm mb-1">Date</label>
          <input id="date" type="date" class="w-full p-2 rounded-lg bg-zinc-800">
        </div>
        <div>
          <label class="block text-sm mb-1">Time</label>
          <input id="time" type="time" class="w-full p-2 rounded-lg bg-zinc-800" value="09:00">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm mb-1">Timezone</label>
          <select id="tz" class="w-full p-2 rounded-lg bg-zinc-800"></select>
        </div>
        <div>
          <label class="block text-sm mb-1">Theme</label>
          <select id="theme" class="w-full p-2 rounded-lg bg-zinc-800">
            <option value="dark" selected>Dark</option>
            <option value="light">Light</option>
          </select>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm mb-1">Show seconds</label>
          <input id="showSec" type="checkbox" class="scale-125" checked>
        </div>
        <div>
          <label class="block text-sm mb-1">Watermark</label>
          <input id="wm" type="checkbox" class="scale-125" checked>
        </div>
      </div>
      <div class="flex gap-2 mt-4">
        <button id="btnUpdate" class="px-4 py-2 rounded-xl bg-white text-black font-semibold">Update</button>
        <button id="btnPNG" class="px-4 py-2 rounded-xl border border-zinc-700">Save PNG</button>
        <button id="btnICS" class="px-4 py-2 rounded-xl border border-zinc-700">Download .ics</button>
      </div>
      <p class="text-xs opacity-60 mt-2">All runs in your browser. No uploads.</p>
    </div>

    <div id="how" class="p-4 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm leading-relaxed">
      <b>Tip</b>: Card shows your selected timezone; .ics includes full timezone info.  
      Share PNG anywhere; add .ics to calendar with alerts.
    </div>
  </section>

  <!-- Card Preview -->
  <section class="flex items-start justify-center">
    <div id="cardWrap" class="p-6">
      <div id="card" class="w-[620px] rounded-3xl card-shadow overflow-hidden">
        <div id="cardInner" class="p-10 bg-gradient-to-br from-zinc-900 to-zinc-800">
          <div id="badge" class="text-xs uppercase tracking-widest opacity-80 mb-1">Countdown</div>
          <h2 id="cTitle" class="text-3xl font-extrabold">Launch Day</h2>
          <p id="cMeta" class="opacity-80 mt-1 text-sm"></p>
          <div class="mt-8 grid grid-cols-4 gap-3 text-center">
            <div><div id="d" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Days</div></div>
            <div><div id="h" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Hours</div></div>
            <div><div id="m" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Minutes</div></div>
            <div><div id="s" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Seconds</div></div>
          </div>
        </div>
        <div id="wmSlot" class="px-6 py-3 text-[10px] text-center bg-black/40 text-white">made with WorldCount</div>
      </div>
    </div>
  </section>
</main>

<script>
const { DateTime, IANAZone } = luxon;

// populate timezone select
(function initTZ() {
  const sel = document.getElementById('tz');
  const guess = DateTime.local().zoneName;
  const common = [
    "UTC","Europe/London","Europe/Paris","Europe/Berlin","Europe/Madrid",
    "America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Sao_Paulo",
    "Asia/Seoul","Asia/Tokyo","Asia/Shanghai","Asia/Singapore","Australia/Sydney","Asia/Kolkata"
  ];
  common.forEach(z=>{
    const opt=document.createElement('option'); opt.value=z; opt.textContent=z+(z===guess?" (current)":"");
    sel.appendChild(opt);
  });
  // fallback
  if(!common.includes(guess)) {
    const opt=document.createElement('option'); opt.value=guess; opt.textContent=guess+" (current)"; sel.prepend(opt);
  }
  sel.value = guess;
  // default date = +7 days
  const d = DateTime.local().plus({days:7});
  document.getElementById('date').value = d.toISODate();
})();
let timer;

function fmtMeta(dt){
  // ex: Tue, Nov 04 2025 · 09:00 · Asia/Seoul (UTC+09:00)
  const off = dt.toFormat("ZZZZ");
  return dt.toFormat("ccc, LLL dd yyyy · HH:mm") + " · " + dt.zoneName + " ("+off+")";
}

function updateTheme(){
  const theme = document.getElementById('theme').value;
  const inner = document.getElementById('cardInner');
  const card = document.getElementById('card');
  if(theme==='light'){
    inner.className = "p-10 bg-gradient-to-br from-white to-zinc-100 text-zinc-900";
    card.classList.remove("text-zinc-50");
    document.body.classList.remove("text-zinc-50");
  } else {
    inner.className = "p-10 bg-gradient-to-br from-zinc-900 to-zinc-800";
  }
}

function render() {
  const title = document.getElementById('title').value || "Untitled";
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value || "00:00";
  const zone = document.getElementById('tz').value;
  const showSec = document.getElementById('showSec').checked;
  const wmOn = document.getElementById('wm').checked;

  document.getElementById('cTitle').textContent = title;
  document.getElementById('wmSlot').style.display = wmOn ? "block" : "none";
  updateTheme();

  if(timer) clearInterval(timer);

  // target datetime in selected zone
  let target = DateTime.fromISO(`${date}T${time}`, { zone: zone });
  if(!target.isValid) return;

  document.getElementById('cMeta').textContent = fmtMeta(target);

  function tick(){
    const now = DateTime.local().setZone(zone);
    let diff = target.diff(now, ['days','hours','minutes','seconds']).toObject();
    // clamp negatives to zero
    let days = Math.max(0, Math.floor(diff.days || 0));
    let hours = Math.max(0, Math.floor(diff.hours || 0));
    let minutes = Math.max(0, Math.floor(diff.minutes || 0));
    let seconds = Math.max(0, Math.floor(diff.seconds || 0));
    document.getElementById('d').textContent = days;
    document.getElementById('h').textContent = String(hours).padStart(2,'0');
    document.getElementById('m').textContent = String(minutes).padStart(2,'0');
    document.getElementById('s').textContent = String(seconds).padStart(2,'0');
    document.getElementById('s').parentElement.style.display = showSec ? "block":"none";
  }
  tick();
  timer = setInterval(tick, 500);
}

function savePNG(){
  const node = document.getElementById('card');
  html2canvas(node, {backgroundColor: null, scale: 2}).then(canvas=>{
    canvas.toBlob(b=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(b);
      a.download = `worldcount_${Date.now()}.png`;
      a.click();
      URL.revokeObjectURL(a.href);
    });
  });
}

function downloadICS(){
  const title = (document.getElementById('title').value || "Untitled").replace(/\n/g,' ');
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value || "00:00";
  const zone = document.getElementById('tz').value;

  const start = luxon.DateTime.fromISO(`${date}T${time}`, {zone});
  if(!start.isValid){ alert("Invalid date/time"); return; }

  // default 1-hour event
  const end = start.plus({hours:1});

  function toICSDate(dt){
    // convert to UTC for DTSTART/DTEND with Z
    return dt.toUTC().toFormat("yyyyMMdd'T'HHmmss'Z'");
    // (Advanced: could embed VTIMEZONE; for MVP keep UTC times with Z)
  }

  const uid = `worldcount-${Date.now()}@local`;
  const ics = [
"BEGIN:VCALENDAR",
"VERSION:2.0",
"PRODID:-//WorldCount//EN",
"BEGIN:VEVENT",
`UID:${uid}`,
`DTSTAMP:${toICSDate(luxon.DateTime.utc())}`,
`DTSTART:${toICSDate(start)}`,
`DTEND:${toICSDate(end)}`,
`SUMMARY:${title}`,
`DESCRIPTION:Created with WorldCount (${window.location.origin || "local"})`,
"END:VEVENT",
"END:VCALENDAR"
  ].join("\r\n");

  const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `worldcount_${Date.now()}.ics`;
  a.click();
  URL.revokeObjectURL(a.href);
}

document.getElementById('btnUpdate').addEventListener('click', render);
document.getElementById('btnPNG').addEventListener('click', savePNG);
document.getElementById('btnICS').addEventListener('click', downloadICS);

// first render
render();
</script>
</body>
</html>
