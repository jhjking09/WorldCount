<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WorldCount — Countdown Card</title>

<meta name="description" content="Create a beautiful countdown card PNG and an .ics event in your browser. No uploads.">
<meta property="og:title" content="WorldCount — Countdown Card">
<meta property="og:description" content="Create a beautiful countdown card & .ics in 10 seconds. (Browser only)">
<meta property="og:type" content="website">
<meta property="og:url" content="">

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23000000'/%3E%3Ctext x='50' y='62' text-anchor='middle' font-size='58' fill='white' font-family='Arial,Helvetica,sans-serif'%3EW%3C/text%3E%3C/svg%3E"/>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  .card-shadow { box-shadow: 0 20px 60px rgba(0,0,0,.35); }
  .tick { letter-spacing: .02em }
</style>
</head>
<body class="bg-zinc-950 text-zinc-50 min-h-screen">
<header class="max-w-6xl mx-auto p-4 flex items-center justify-between">
  <h1 class="text-xl font-extrabold">WorldCount</h1>
  <a class="text-xs opacity-70 hover:opacity-100 underline underline-offset-4" href="#how">How it works</a>
</header>

<main class="max-w-6xl mx-auto px-4 pb-24 grid lg:grid-cols-2 gap-8">
  <!-- Controls -->
  <section class="space-y-4">
    <div class="p-4 rounded-2xl bg-zinc-900/60 border border-zinc-800">
      <label class="block text-sm mb-1">Title</label>
      <input id="title" class="w-full p-2 rounded-lg bg-zinc-800" placeholder="Launch Day" value="Launch Day" autocomplete="off">
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm mb-1">Date</label>
          <input id="date" type="date" class="w-full p-2 rounded-lg bg-zinc-800" autocomplete="off">
        </div>
        <div>
          <label class="block text-sm mb-1">Time</label>
          <input id="time" type="time" class="w-full p-2 rounded-lg bg-zinc-800" value="09:00" autocomplete="off">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div>
          <label class="block text-sm mb-1">Timezone</label>
          <select id="tz" class="w-full p-2 rounded-lg bg-zinc-800"></select>
        </div>
        <div>
          <label class="block text-sm mb-1">Theme</label>
          <select id="theme" class="w-full p-2 rounded-lg bg-zinc-800">
            <option value="dark" selected>Dark</option>
            <option value="light">Light</option>
          </select>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <label class="flex items-center gap-2"><input id="showSec" type="checkbox" class="scale-125" checked> <span class="text-sm">Show seconds</span></label>
        <label class="flex items-center gap-2"><input id="wm" type="checkbox" class="scale-125" checked> <span class="text-sm">Watermark</span></label>
      </div>

      <div class="flex flex-wrap items-center gap-2 mt-4">
        <button id="btnUpdate" class="px-4 py-2 rounded-xl bg-white text-black font-semibold">Update</button>
        <button id="btnPNG" class="px-4 py-2 rounded-xl border border-zinc-700">Save PNG</button>
        <button id="btnICS" class="px-4 py-2 rounded-xl border border-zinc-700">Download .ics</button>
      </div>
      <p class="text-xs opacity-60 mt-2">All runs in your browser. No uploads.</p>
    </div>

    <!-- Share link box -->
    <div id="shareBox" class="hidden p-3 rounded-xl bg-zinc-900/60 border border-zinc-800">
      <div class="text-xs mb-1 opacity-80">Share link (prefilled)</div>
      <div class="flex gap-2">
        <input id="shareUrl" class="flex-1 bg-zinc-800 p-2 rounded-lg text-xs" readonly>
        <button id="btnCopy" class="px-3 py-2 rounded-lg border border-zinc-700 text-xs">Copy</button>
      </div>
      <div id="copyMsg" class="text-[10px] mt-1 opacity-60"></div>
    </div>

    <div id="how" class="p-4 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm leading-relaxed">
      <b>How it works</b>
      <ol class="list-decimal pl-5 space-y-1 mt-1">
        <li>Set Title / Date / Time / Timezone, then <b>Update</b>.</li>
        <li>Share link updates with your settings. Copy it or save a PNG.</li>
        <li>Use <b>Download .ics</b> to add it to your calendar.</li>
      </ol>
    </div>
  </section>

  <!-- Card Preview -->
  <section class="flex items-start justify-center">
    <div id="cardWrap" class="p-6">
      <div id="card" class="w-[620px] rounded-3xl card-shadow overflow-hidden">
        <div id="cardInner" class="p-10 bg-gradient-to-br from-zinc-900 to-zinc-800">
          <div id="badge" class="text-xs uppercase tracking-widest opacity-80 mb-1">COUNTDOWN</div>
          <h2 id="cTitle" class="text-3xl font-extrabold">Launch Day</h2>
          <p id="cMeta" class="opacity-80 mt-1 text-sm"></p>
          <div class="mt-8 grid grid-cols-4 gap-3 text-center select-none">
            <div><div id="d" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Days</div></div>
            <div><div id="h" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Hours</div></div>
            <div><div id="m" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Minutes</div></div>
            <div><div id="s" class="text-5xl font-black tick">0</div><div class="opacity-70 text-xs mt-1">Seconds</div></div>
          </div>
        </div>
        <div id="wmSlot" class="px-6 py-3 text-[10px] text-center bg-black/40 text-white">made with WorldCount</div>
      </div>
    </div>
  </section>
</main>

<script>
const { DateTime } = luxon;
let timer;

// Timezone list + defaults
(function initTZ() {
  const sel = document.getElementById('tz');
  const guess = DateTime.local().zoneName;
  const common = [
    "UTC","Europe/London","Europe/Paris","Europe/Berlin","Europe/Madrid",
    "America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Sao_Paulo",
    "Asia/Seoul","Asia/Tokyo","Asia/Shanghai","Asia/Singapore","Australia/Sydney","Asia/Kolkata"
  ];
  if (!common.includes(guess)) {
    const opt=document.createElement('option'); opt.value=guess; opt.textContent=guess+" (current)"; sel.appendChild(opt);
  }
  common.forEach(z=>{
    const opt=document.createElement('option'); opt.value=z; opt.textContent=z+(z===guess?" (current)":"");
    sel.appendChild(opt);
  });

  // default date = +7 days
  const d = DateTime.local().plus({days:7});
  document.getElementById('date').value = d.toISODate();

  // respect system theme
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
    document.getElementById('theme').value = 'light';
  }
})();

// Prefill from query
function applyQueryPreset(){
  const p = new URLSearchParams(location.search);
  if (p.get("title")) document.getElementById("title").value = decodeURIComponent(p.get("title"));
  if (p.get("date"))  document.getElementById("date").value  = p.get("date");
  if (p.get("time"))  document.getElementById("time").value  = p.get("time");
  if (p.get("tz"))    document.getElementById("tz").value    = p.get("tz");
  if (p.get("theme")) document.getElementById("theme").value = p.get("theme");
}

// Build a shareable URL and update address bar
function buildShareURL(){
  const title = encodeURIComponent(document.getElementById('title').value || "");
  const date  = document.getElementById('date').value || "";
  const time  = document.getElementById('time').value || "";
  const tz    = document.getElementById('tz').value || "";
  const theme = document.getElementById('theme').value || "dark";
  const q = `?title=${title}&date=${date}&time=${time}&tz=${encodeURIComponent(tz)}&theme=${theme}`;
  const url = location.origin + location.pathname + q;
  history.replaceState(null, "", q); // update address bar (relative)
  const box = document.getElementById('shareBox');
  const input = document.getElementById('shareUrl');
  input.value = url;
  box.classList.remove('hidden');
}

// Copy helper
async function copyShare(){
  const input = document.getElementById('shareUrl');
  try {
    await navigator.clipboard.writeText(input.value);
    document.getElementById('copyMsg').textContent = "Copied!";
  } catch {
    input.select(); document.execCommand('copy');
    document.getElementById('copyMsg').textContent = "Copied (fallback)!";
  }
}

function fmtMeta(dt){
  const off = dt.toFormat("ZZZZ");
  return dt.toFormat("ccc, LLL dd yyyy · HH:mm") + " · " + dt.zoneName + " ("+off+")";
}

function updateTheme(){
  const theme = document.getElementById('theme').value;
  const inner = document.getElementById('cardInner');
  if(theme==='light'){
    inner.className = "p-10 bg-gradient-to-br from-white to-zinc-100 text-zinc-900";
    document.body.classList.remove("text-zinc-50");
  } else {
    inner.className = "p-10 bg-gradient-to-br from-zinc-900 to-zinc-800";
  }
}

function render() {
  const title = document.getElementById('title').value || "Untitled";
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value || "00:00";
  const zone = document.getElementById('tz').value;
  const showSec = document.getElementById('showSec').checked;
  const wmOn = document.getElementById('wm').checked;

  document.getElementById('cTitle').textContent = title;
  document.getElementById('wmSlot').style.display = wmOn ? "block" : "none";
  updateTheme();

  if (timer) clearInterval(timer);
  const target = luxon.DateTime.fromISO(`${date}T${time}`, { zone: zone });
  if (!target.isValid) return;

  document.getElementById('cMeta').textContent = fmtMeta(target);

  function tick(){
    const now = luxon.DateTime.local().setZone(zone);
    let diff = target.diff(now, ['days','hours','minutes','seconds']).toObject();
    let days = Math.max(0, Math.floor(diff.days || 0));
    let hours = Math.max(0, Math.floor(diff.hours || 0));
    let minutes = Math.max(0, Math.floor(diff.minutes || 0));
    let seconds = Math.max(0, Math.floor(diff.seconds || 0));
    document.getElementById('d').textContent = days;
    document.getElementById('h').textContent = String(hours).padStart(2,'0');
    document.getElementById('m').textContent = String(minutes).padStart(2,'0');
    document.getElementById('s').textContent = String(seconds).padStart(2,'0');
    document.getElementById('s').parentElement.style.display = showSec ? "block":"none";
  }
  tick();
  timer = setInterval(tick, 500);
}

function savePNG(){
  const node = document.getElementById('card');
  const scale = 2; // fixed 2x export
  html2canvas(node, {backgroundColor: null, scale}).then(canvas=>{
    canvas.toBlob(b=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(b);
      a.download = `worldcount_${Date.now()}@${scale}x.png`;
      a.click();
      URL.revokeObjectURL(a.href);
    });
  });
}

function toICSDate(dt){ return dt.toUTC().toFormat("yyyyMMdd'T'HHmmss'Z'"); }

function downloadICS(){
  const title = (document.getElementById('title').value || "Untitled").replace(/\n/g,' ');
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value || "00:00";
  const zone = document.getElementById('tz').value;

  const start = luxon.DateTime.fromISO(`${date}T${time}`, {zone});
  if(!start.isValid){ alert("Invalid date/time"); return; }
  const end = start.plus({hours:1});
  const uid = `worldcount-${Date.now()}@local`;

  const ics = [
"BEGIN:VCALENDAR",
"VERSION:2.0",
"PRODID:-//WorldCount//EN",
"BEGIN:VEVENT",
`UID:${uid}`,
`DTSTAMP:${toICSDate(luxon.DateTime.utc())}`,
`DTSTART:${toICSDate(start)}`,
`DTEND:${toICSDate(end)}`,
`SUMMARY:${title}`,
`DESCRIPTION:Created with WorldCount`,
"END:VEVENT",
"END:VCALENDAR"
  ].join("\r\n");

  const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `worldcount_${Date.now()}.ics`;
  a.click();
  URL.revokeObjectURL(a.href);
}

// Wire up
document.getElementById('btnUpdate').addEventListener('click', ()=>{ render(); buildShareURL(); });
document.getElementById('btnPNG').addEventListener('click', savePNG);
document.getElementById('btnICS').addEventListener('click', downloadICS);
document.getElementById('btnCopy').addEventListener('click', copyShare);

// First render (with query presets)
applyQueryPreset();
render();
buildShareURL();
</script>
</body>
</html>
